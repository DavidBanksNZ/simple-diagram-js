!function(){"use strict"
var t={argsToArray:function(t){return Array.prototype.slice.call(t)},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},cloneShallow:function(t){var e={}
for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])
return e},mergeObjects:function(e,a){var n=t.cloneShallow(e)
for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])
return n}},e={subscript:/_{([^}]*)}/g,superscript:/\^{([^}]*)}/g},a={addGrid:!0,cellSize:25,numRows:10,numColumns:10,margin:1,interactive:!0},n=function(t,e,a){var n,s=e.numColumns+1,r=e.numRows+1,l=e.numColumns*e.cellSize,i=e.numRows*e.cellSize,o=t.append("g").attr("class","grid")
for(a&&o.style(a),n=0;s>n;n++)o.append("line").attr({x1:n*e.cellSize,x2:n*e.cellSize,y1:0,y2:i})
for(n=0;r>n;n++)o.append("line").attr({x1:0,x2:l,y1:n*e.cellSize,y2:n*e.cellSize})},s=function(t){var e=t.getCanvas()
e.on("mouseover",function(){var e=d3.event.target.parentNode,a=t.__settings,n=a.cellSize*a.numColumns,s=(a.cellSize*a.numRows,a.margin),r="node"===e.className.baseVal
if(r||"tspan"!==d3.event.target.tagName||"node"!==e.parentNode.className.baseVal||(r=!0,e=e.parentNode),r){var i=e,c=i.getAttribute("data-name"),p=o(t,c),u=l(t,p.row,p.column)
t.__tooltip.html(p.tooltipHTML).style("display","block")
var d=t.__tooltip.node().getBoundingClientRect(),y=d.width,h=d.height,m=u.x+s,_=u.y+s
m+y>n&&(m=n+s-y),_-=10+h,s>_&&_>=s-5&&(_=s),s-5>_&&(_=u.y+s+a.cellSize-h,m=m+a.cellSize+10+y<n?u.x+s+a.cellSize+10:u.x+s-y-10),t.__tooltip.style({left:m+"px",top:_+"px"}),t.__tooltip.transition().duration(200).style("opacity",t.__tooltipAlpha),d3.select(i).classed("active",!0)}}),e.on("mouseout",function(){t.__tooltip.transition().delay(200).duration(200).style("opacity",0).each("end",function(){t.__tooltip.style("display","none")}),e.select(".node.active").classed("active",!1)})},r=function(t){var e=t.__settings,a=t.__container.append("div"),r=a.append("svg"),l=e.cellSize*e.numColumns,i=e.cellSize*e.numRows
r.attr("class","simple-diagram"),a.style("position","relative"),r.attr({height:i+2*e.margin,width:l+2*e.margin})
var o=r.append("defs"),c=r.append("g").attr("transform","translate("+e.margin+","+e.margin+")")
o.append("marker").attr({id:"arrow",refX:8,refY:3,markerUnit:"userSpaceOnUse",markerWidth:8,markerHeight:6,orient:"auto"}).append("path").attr("d","M 0 0 8 3 0 6 Z"),e.addGrid&&n(c,e)
var p=c.append("g").attr("class","canvas")
t.__canvas=p,t.__nodeData={},e.interactive&&(t.__tooltip=a.append("div").attr("class","simple-diagram-tooltip").style({position:"absolute",display:"none"}),t.__tooltipAlpha=t.__tooltip.style("opacity"),t.__tooltip.style("opacity",0),s(t))},l=function(t,e,a){return{x:(a-1)*t.__settings.cellSize,y:(e-1)*t.__settings.cellSize}},i=function(e,a){var n,s=t.cloneShallow(a)
e.__settings.interactive&&(n=a.hoverText,n=n.replace(/\^{([^}]*)}/,"<sup>$1</sup>").replace(/\_{([^}]*)}/,"<sub>$1</sub>"),s.tooltipHTML=n),e.__nodeData[a.name]=s},o=function(t,e){return t.__nodeData[e]},c=function(t,a,n){var s=l(t,a.row,a.column),r=a.label,i=r.search(e.subscript)>-1,o=r.search(e.superscript)>-1
i&&(r=r.replace(e.subscript,"%%<sub>$1</sub>%%")),o&&(r=r.replace(e.superscript,"%%<sup>$1</sup>%%"))
var c=r.split("%%"),p=document.createElementNS(d3.ns.prefix.svg,"text"),u=d3.select(p).attr({x:s.x+t.__settings.cellSize/2,y:s.y+t.__settings.cellSize/2,"text-anchor":a.align||"middle","class":"label"})
n||t.getCanvas().node().appendChild(u.node()),a["class"]&&u.classed(a["class"],!0),a.style&&u.style(a.style)
var d,y=-.6,h=.3
return d=i?-.2:o?-.4:-.3,c.forEach(function(t){if(t){var e,a=u.append("tspan")
t.search("<sup>")>-1?(e=t.replace(/<sup>(.*?)<\/sup>/,"$1"),a.attr("dy",y-d+"em").attr("class","superscript"),d=y):t.search("<sub>")>-1?(e=t.replace(/<sub>(.*?)<\/sub>/,"$1"),a.attr("dy",h-d+"em").attr("class","subscript"),d=h):(e=t,a.attr("dy",-d+"em"),d=0),a.text(e)}}),u},p=function(t,e,a){var n,s=e.column>a.column,r=l(t,e.row,e.column),i=l(t,a.row,a.column),o=t.__settings.cellSize,c=o/2,p=r.x+c,u=r.y+c,d=i.x+c,y=i.y+c,h=p===d?NaN:(y-u)/(d-p)
return s&&(c*=-1),h>=2||isNaN(h)&&y>u?(u+=c,y-=c):h>=1?(p+=c,u+=c,d-=c,y-=c):h>-1?(p+=c,d-=c):h>-2?(p+=c,u-=c,d-=c,y+=c):(u-=c,y+=c),n=isNaN(h)?Math.PI/2+(u>y?-1:1)*Math.PI/2:Math.atan(h)+(s?-1:1)*Math.PI/2,"circle"===e.shape?(p=r.x+o/2*(1+Math.cos(n-Math.PI/2)),u=r.y+o/2*(1+Math.sin(n-Math.PI/2))):null===e.shape&&(p=r.x+o/2,u=r.y+o/2),"circle"===a.shape?(d=i.x+o/2*(1-Math.cos(Math.PI/2-n)),y=i.y+o/2*(1+Math.sin(Math.PI/2-n))):null===a.shape&&(d=i.x+o/2,y=i.y+o/2),{x1:p,y1:u,x2:d,y2:y}},u=function(t,e){"undefined"==typeof e.addArrow&&(e.addArrow=!0)
var a,n
"string"==typeof e.from?a=o(t,e.from):e.from instanceof Array&&(a={row:e.from[0],column:e.from[1],shape:null}),"string"==typeof e.to?n=o(t,e.to):e.to instanceof Array&&(n={row:e.to[0],column:e.to[1],shape:null})
var s=p(t,a,n),r=t.getCanvas().append("line").attr(s).attr("class","line")
e.addArrow&&r.attr("marker-end","url(#arrow)"),e["class"]&&r.classed(e["class"],!0),e.style&&r.style(e.style)},d=function(t,e){var a=l(t,e.row,e.column),n=e.width*t.__settings.cellSize,s=e.height*t.__settings.cellSize,r=t.getCanvas().append("rect").attr({"class":"box",x:a.x,y:a.y,width:n,height:s})
e["class"]&&r.classed(e["class"],!0),e.style&&r.style(e.style)},y=function(t,e,a){var n,s=l(t,e.row,e.column),r=t.__settings.cellSize
n="circle"===e.shape?a.append("circle").attr({cx:s.x+r/2,cy:s.y+r/2,r:r/2}):a.append("rect").attr({x:s.x,y:s.y,width:r,height:r}),n.attr("class","node-shape "+e.shape),e.style&&n.style(e.style)},h=function(t,e){"circle"!==e.shape&&"square"!==e.shape&&(e.shape="circle")
var a=t.getCanvas().append("g").attr("class","node").attr("data-name",e.name)
i(t,e),e.style=e.shapeStyle,y(t,e,a),e.style=e.labelStyle
var n=c(t,e,!0)
a.node().appendChild(n.node()),e["class"]&&a.classed(e["class"],!0)},m=function(e,n){return this.__container=d3.select(e),this.__settings=t.mergeObjects(a,n),r(this),this}
m.prototype.addNode=function(t){return h(this,t),this},m.prototype.addLine=function(t){return u(this,t),this},m.prototype.addLabel=function(t){return c(this,t,!1),this},m.prototype.addBox=function(t){return d(this,t),this},m.prototype.getCoordinatesAtCell=function(t,e){return l(this,t,e)},m.prototype.getCanvas=function(){return this.__canvas},window.SimpleDiagram=m}()
