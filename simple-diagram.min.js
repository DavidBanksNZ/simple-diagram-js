!function(){"use strict";var S={cloneShallow:function(t){var e={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},mergeObjects:function(t,e){var a=S.cloneShallow(t);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a},applyStyles:function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.style(a,e[a])}},d=/_{([^}]*)}/g,u=/\^{([^}]*)}/g,a={addGrid:!0,cellSize:25,numRows:10,numColumns:10,margin:1,interactive:!0},r=function(t){var e=t.__settings,a=t.__container.append("div"),r=a.append("svg"),s=e.cellSize*e.numColumns,n=e.cellSize*e.numRows;a.style("position","relative"),r.attr("class","simple-diagram").attr("height",n+2*e.margin).attr("width",s+2*e.margin);var l=r.append("defs"),o=r.append("g").attr("transform","translate("+e.margin+","+e.margin+")");l.append("marker").attr("id","arrow").attr("refX",8).attr("refY",3).attr("markerUnit","userSpaceOnUse").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 8 3 0 6 Z"),e.addGrid&&function(t,e,a){var r=e.numColumns+1,s=e.numRows+1,n=e.numColumns*e.cellSize,l=e.numRows*e.cellSize,o=t.append("g").attr("class","grid");a&&S.applyStyles(o,a);for(var i=0;i<r;i++)o.append("line").attr("x1",i*e.cellSize).attr("x2",i*e.cellSize).attr("y1",0).attr("y2",l);for(var c=0;c<s;c++)o.append("line").attr("x1",0).attr("x2",n).attr("y1",c*e.cellSize).attr("y2",c*e.cellSize)}(o,e);var h,i,c=o.append("g").attr("class","canvas");t.__canvas=c,t.__nodeData={},e.interactive&&(t.__tooltip=a.append("div").attr("class","simple-diagram-tooltip").style("position","absolute").style("display","none"),t.__tooltipAlpha=t.__tooltip.style("opacity"),t.__tooltip.style("opacity",0),(i=(h=t).getCanvas()).on("mouseover",function(){var t=d3.event.target.parentNode,e=h.__settings,a=e.cellSize*e.numColumns,r=(e.cellSize,e.numRows,e.margin),s="node"===t.className.baseVal;if(s||"tspan"!==d3.event.target.tagName||"node"!==t.parentNode.className.baseVal||(s=!0,t=t.parentNode),s){var n=t,l=n.getAttribute("data-name"),o=w(h,l),i=x(h,o.row,o.column);h.__tooltip.html(o.tooltipHTML).style("display","block");var c=h.__tooltip.node().getBoundingClientRect(),p=c.width,d=c.height,u=i.x+r,y=i.y+r;a<u+p&&(u=a+r-p),(y-=10+d)<r&&r-5<=y&&(y=r),y<r-5&&(y=i.y+r+e.cellSize-d,u=u+e.cellSize+10+p<a?i.x+r+e.cellSize+10:i.x+r-p-10),S.applyStyles(h.__tooltip,{left:u+"px",top:y+"px"}),h.__tooltip.transition().duration(200).style("opacity",h.__tooltipAlpha),d3.select(n).classed("active",!0)}}),i.on("mouseout",function(){h.__tooltip.transition().delay(200).duration(200).style("opacity",0).on("end",function(){h.__tooltip.style("display","none")}),i.select(".node.active").classed("active",!1)}))},x=function(t,e,a){return{x:(a-1)*t.__settings.cellSize,y:(e-1)*t.__settings.cellSize}},w=function(t,e){return t.__nodeData[e]},h=function(t,e,a){var r=x(t,e.row,e.column),s=e.label,n=-1<s.search(d),l=-1<s.search(u);n&&(s=s.replace(d,"%%<sub>$1</sub>%%")),l&&(s=s.replace(u,"%%<sup>$1</sup>%%"));var o=s.split("%%"),i=document.createElementNS(d3.namespace("svg").space,"text"),c=d3.select(i).attr("x",r.x+t.__settings.cellSize/2).attr("y",r.y+t.__settings.cellSize/2).attr("text-anchor",e.align||"middle").attr("class","label");a||t.getCanvas().node().appendChild(c.node()),e.class&&c.classed(e.class,!0),e.style&&S.applyStyles(c,e.style);var p;return p=n?-.2:l?-.4:-.3,o.forEach(function(t){if(t){var e,a=c.append("tspan");-1<t.search("<sup>")?(e=t.replace(/<sup>(.*?)<\/sup>/,"$1"),a.attr("dy",-.6-p+"em").attr("class","superscript"),p=-.6):-1<t.search("<sub>")?(e=t.replace(/<sub>(.*?)<\/sub>/,"$1"),a.attr("dy",.3-p+"em").attr("class","subscript"),p=.3):(e=t,a.attr("dy",-p+"em"),p=0),a.text(e)}}),c},e=function(t,e){var a,r;void 0===e.addArrow&&(e.addArrow=!0),"string"==typeof e.from?a=w(t,e.from):e.from instanceof Array&&(a={row:e.from[0],column:e.from[1],shape:null}),"string"==typeof e.to?r=w(t,e.to):e.to instanceof Array&&(r={row:e.to[0],column:e.to[1],shape:null});var s,n,l,o,i,c,p,d,u,y,h,m,_,g,v=(s=t,l=r,i=(n=a).column>l.column,c=x(s,n.row,n.column),p=x(s,l.row,l.column),d=s.__settings.cellSize,u=d/2,y=c.x+u,h=c.y+u,m=p.x+u,_=p.y+u,i&&(u*=-1),2<=(g=y===m?NaN:(_-h)/(m-y))||isNaN(g)&&h<_?(h+=u,_-=u):1<=g?(y+=u,h+=u,m-=u,_-=u):-1<g?(y+=u,m-=u):(-2<g?(y+=u,h-=u,m-=u):h-=u,_+=u),o=isNaN(g)?Math.PI/2+(_<h?-1:1)*Math.PI/2:Math.atan(g)+(i?-1:1)*Math.PI/2,"circle"===n.shape?(y=c.x+d/2*(1+Math.cos(o-Math.PI/2)),h=c.y+d/2*(1+Math.sin(o-Math.PI/2))):null===n.shape&&(y=c.x+d/2,h=c.y+d/2),"circle"===l.shape?(m=p.x+d/2*(1-Math.cos(Math.PI/2-o)),_=p.y+d/2*(1+Math.sin(Math.PI/2-o))):null===l.shape&&(m=p.x+d/2,_=p.y+d/2),{x1:y,y1:h,x2:m,y2:_}),f=t.getCanvas().append("line").attr("x1",v.x1).attr("x2",v.x2).attr("y1",v.y1).attr("y2",v.y2).attr("class","line");e.addArrow&&f.attr("marker-end","url(#arrow)"),e.class&&f.classed(e.class,!0),e.style&&S.applyStyles(f,e.style)},s=function(t,e){"circle"!==e.shape&&"square"!==e.shape&&(e.shape="circle");var a,r,s,n,l,o,i,c,p,d,u=t.getCanvas().append("g").attr("class","node").attr("data-name",e.name);a=t,r=e,n=S.cloneShallow(r),a.__settings.interactive&&(s=(s=r.hoverText).replace(/\^{([^}]*)}/,"<sup>$1</sup>").replace(/\_{([^}]*)}/,"<sub>$1</sub>"),n.tooltipHTML=s),a.__nodeData[r.name]=n,e.style=e.shapeStyle,i=u,p=x(l=t,(o=e).row,o.column),d=l.__settings.cellSize,(c="circle"===o.shape?i.append("circle").attr("cx",p.x+d/2).attr("cy",p.y+d/2).attr("r",d/2):i.append("rect").attr("x",p.x).attr("y",p.y).attr("width",d).attr("height",d)).attr("class","node-shape "+o.shape),o.style&&S.applyStyles(c,o.style),e.style=e.labelStyle;var y=h(t,e,!0);u.node().appendChild(y.node()),e.class&&u.classed(e.class,!0)},t=function(t,e){return this.__container=d3.select(t),this.__settings=S.mergeObjects(a,e),r(this),this};t.prototype.addNode=function(t){return s(this,t),this},t.prototype.addLine=function(t){return e(this,t),this},t.prototype.addLabel=function(t){return h(this,t,!1),this},t.prototype.addBox=function(t){var e,a,r,s,n,l;return r=x(e=this,(a=t).row,a.column),s=a.width*e.__settings.cellSize,n=a.height*e.__settings.cellSize,l=e.getCanvas().append("rect").attr("class","box").attr("x",r.x).attr("y",r.y).attr("width",s).attr("height",n),a.class&&l.classed(a.class,!0),a.style&&S.applyStyles(l,a.style),this},t.prototype.getCoordinatesAtCell=function(t,e){return x(this,t,e)},t.prototype.getCanvas=function(){return this.__canvas},window.SimpleDiagram=t}();