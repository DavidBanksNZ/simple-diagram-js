!function(){"use strict"
var t={argsToArray:function(t){return Array.prototype.slice.call(t)},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},cloneShallow:function(t){var e={}
for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])
return e},mergeObjects:function(e,a){var n=t.cloneShallow(e)
for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(n[s]=a[s])
return n}},e={subscript:/_{([^}]*)}/g,superscript:/\^{([^}]*)}/g},a={addGrid:!0,cellSize:25,numRows:10,numColumns:10,margin:2,interactive:!0},n=function(t,e,a){var n,s=e.numColumns+1,r=e.numRows+1,l=e.numColumns*e.cellSize,i=e.numRows*e.cellSize,o=t.append("g").attr("class","grid")
for(a&&o.style(a),n=0;s>n;n++)o.append("line").attr({x1:n*e.cellSize,x2:n*e.cellSize,y1:0,y2:i})
for(n=0;r>n;n++)o.append("line").attr({x1:0,x2:l,y1:n*e.cellSize,y2:n*e.cellSize})},s=function(t){var e=t.getCanvas()
e.on("mouseover",function(){var e=d3.event.target.parentNode,a=t.__settings,n=a.cellSize*a.numColumns,s=(a.cellSize*a.numRows,a.margin),r="node"===e.className.baseVal
if(r||"tspan"!==d3.event.target.tagName||"node"!==e.parentNode.className.baseVal||(r=!0,e=e.parentNode),r){var i=e,c=i.getAttribute("data-name"),p=o(t,c),u=l(t,p.row,p.column)
t.__tooltip.html(p.tooltipHTML).style("display","block")
var d=t.__tooltip.node().getBoundingClientRect(),y=d.width,h=d.height,_=u.x+s,m=u.y+s
_+y>n&&(_=n+s-y),m-=10+h,s>m&&m>=s-5&&(m=s),s-5>m&&(m=u.y+s+a.cellSize-h,_=_+a.cellSize+10+y<n?u.x+s+a.cellSize+10:u.x+s-y-10),t.__tooltip.style({left:_+"px",top:m+"px"}),t.__tooltip.transition().duration(200).style("opacity",t.__tooltipAlpha),d3.select(i).classed("active",!0)}}),e.on("mouseout",function(){t.__tooltip.transition().delay(200).duration(200).style("opacity",0).each("end",function(){t.__tooltip.style("display","none")}),e.select(".node.active").classed("active",!1)})},r=function(t){var e=t.__settings,a=t.__container.append("div"),r=a.append("svg")
r.attr("class","simple-diagram"),a.style("position","relative")
var l=e.cellSize*e.numColumns,i=e.cellSize*e.numRows,o=r.append("defs")
r.attr({height:i+2*e.margin,width:l+2*e.margin})
var c=r.append("g").attr("transform","translate("+e.margin+","+e.margin+")")
o.append("marker").attr({id:"arrow",refX:8,refY:3,markerUnit:"userSpaceOnUse",markerWidth:8,markerHeight:6,orient:"auto"}).append("path").attr("d","M 0 0 8 3 0 6 Z"),e.addGrid&&n(c,e)
var p=c.append("g").attr("class","canvas")
t.__canvas=p,t.__nodeData={},e.interactive&&(t.__tooltip=a.append("div").attr("class","simple-diagram-tooltip").style({position:"absolute",display:"none"}),t.__tooltipAlpha=t.__tooltip.style("opacity"),t.__tooltip.style("opacity",0),s(t))},l=function(t,e,a){return{x:(a-1)*t.__settings.cellSize,y:(e-1)*t.__settings.cellSize}},i=function(e,a){var n,s=t.cloneShallow(a)
e.__settings.interactive&&(n=a.hoverText,n=n.replace(/\^{([^}]*)}/,"<sup>$1</sup>").replace(/\_{([^}]*)}/,"<sub>$1</sub>"),s.tooltipHTML=n),e.__nodeData[a.name]=s},o=function(t,e){return t.__nodeData[e]},c=function(t,a,n){a||(a=t.__canvas)
var s=l(t,n.row,n.column),r=n.label,i=r.search(e.subscript)>-1,o=r.search(e.superscript)>-1
i&&(r=r.replace(e.subscript,"%%<sub>$1</sub>%%")),o&&(r=r.replace(e.superscript,"%%<sup>$1</sup>%%"))
var c=r.split("%%"),p=a.append("text").attr({x:s.x+t.__settings.cellSize/2,y:s.y+t.__settings.cellSize/2,"text-anchor":n.align||"middle","class":"label"})
n["class"]&&p.classed(n["class"],!0),n.style&&p.style(n.style)
var u,d=-.6,y=.3
u=i?-.2:o?-.4:-.3,c.forEach(function(t){if(t){var e,a=p.append("tspan")
t.search("<sup>")>-1?(e=t.replace(/<sup>(.*?)<\/sup>/,"$1"),a.attr("dy",d-u+"em").attr("class","superscript"),u=d):t.search("<sub>")>-1?(e=t.replace(/<sub>(.*?)<\/sub>/,"$1"),a.attr("dy",y-u+"em").attr("class","subscript"),u=y):(e=t,a.attr("dy",-u+"em"),u=0),a.text(e)}})},p=function(t,e,a){var n,s=e.column>a.column,r=l(t,e.row,e.column),i=l(t,a.row,a.column),o=t.__settings.cellSize,c=o/2,p=r.x+c,u=r.y+c,d=i.x+c,y=i.y+c,h=p===d?NaN:(y-u)/(d-p)
return s&&(c*=-1),h>=2||isNaN(h)&&y>u?(u+=c,y-=c):h>=1?(p+=c,u+=c,d-=c,y-=c):h>-1?(p+=c,d-=c):h>-2?(p+=c,u-=c,d-=c,y+=c):(u-=c,y+=c),n=isNaN(h)?Math.PI/2+(u>y?-1:1)*Math.PI/2:Math.atan(h)+(s?-1:1)*Math.PI/2,"circle"===e.shape?(p=r.x+o/2*(1+Math.cos(n-Math.PI/2)),u=r.y+o/2*(1+Math.sin(n-Math.PI/2))):null===e.shape&&(p=r.x+o/2,u=r.y+o/2),"circle"===a.shape?(d=i.x+o/2*(1-Math.cos(Math.PI/2-n)),y=i.y+o/2*(1+Math.sin(Math.PI/2-n))):null===a.shape&&(d=i.x+o/2,y=i.y+o/2),{x1:p,y1:u,x2:d,y2:y}},u=function(t,e,a){e||(e=t.__canvas),"undefined"==typeof a.addArrow&&(a.addArrow=!0)
var n,s
"string"==typeof a.from?n=o(t,a.from):a.from instanceof Array&&(n={row:a.from[0],column:a.from[1],shape:null}),"string"==typeof a.to?s=o(t,a.to):a.to instanceof Array&&(s={row:a.to[0],column:a.to[1],shape:null})
var r=p(t,n,s),l=e.append("line").attr(r).attr("class","line")
a.addArrow&&l.attr("marker-end","url(#arrow)"),a["class"]&&l.classed(a["class"],!0),a.style&&l.style(a.style)},d=function(t,e,a){e||(e=t.__canvas)
var n=l(t,a.row,a.column),s=a.width*t.__settings.cellSize,r=a.height*t.__settings.cellSize,i=e.append("rect").attr({"class":"box",x:n.x,y:n.y,width:s,height:r})
a["class"]&&i.classed(a["class"],!0),a.style&&i.style(a.style)},y=function(t,e,a){e||(e=t.__canvas)
var n,s=l(t,a.row,a.column),r=t.__settings.cellSize
n="circle"===a.shape?e.append("circle").attr({cx:s.x+r/2,cy:s.y+r/2,r:r/2}):e.append("rect").attr({x:s.x,y:s.y,width:r,height:r}),n.attr("class","node-shape "+a.shape),a.style&&n.style(a.style)},h=function(t,e,a){e||(e=t.__canvas)
var n=e.append("g").attr("class","node").attr("data-name",a.name)
i(t,a),a.style=a.shapeStyle,y(t,n,a),a.style=a.labelStyle,c(t,n,a),a["class"]&&n.classed(a["class"],!0)},_=function(e,n){return this.__container=d3.select(e),this.__settings=t.mergeObjects(a,n),r(this),this}
_.prototype.addNode=function(t){return h(this,null,t),this},_.prototype.addLine=function(t){return u(this,null,t),this},_.prototype.addLabel=function(t){return c(this,null,t),this},_.prototype.addBox=function(t){return d(this,null,t),this},_.prototype.getCoordinatesAtCell=function(t,e){return l(this,t,e)},_.prototype.getCanvas=function(){return this.__canvas},window.SimpleDiagram=_}()
