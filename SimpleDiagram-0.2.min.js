!function(){"use strict";var t={argsToArray:function(t){return Array.prototype.slice.call(t)},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},cloneShallow:function(t){var e={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},mergeObjects:function(e,a){var s=t.cloneShallow(e);for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(s[n]=a[n]);return s},setAttrs:function(t,e){var a="";for(a in e)e.hasOwnProperty(a)&&t.attr(a,e[a]);return t},setStyles:function(t,e){var a="";for(a in e)e.hasOwnProperty(a)&&t.style(a,e[a]);return t}},e={subscript:/_{([^}]*)}/g,superscript:/\^{([^}]*)}/g},a={addGrid:!0,cellSize:25,numRows:10,numColumns:10,margin:1,interactive:!0},s=function(e,a,s){var n,r=a.numColumns+1,l=a.numRows+1,o=a.numColumns*a.cellSize,i=a.numRows*a.cellSize,c=e.append("g");for(c.attr("class","grid"),s&&c.style(s),n=0;n<r;n++){var p=c.append("line");t.setAttrs(p,{x1:n*a.cellSize,x2:n*a.cellSize,y1:0,y2:i})}for(n=0;n<l;n++){var u=c.append("line");t.setAttrs(u,{x1:0,x2:o,y1:n*a.cellSize,y2:n*a.cellSize})}},n=function(e){var a=e.getCanvas();a.on("mouseover",function(){var a=d3.event.target.parentNode,s=e.__settings,n=s.cellSize*s.numColumns,r=(s.cellSize,s.numRows,s.margin),o="node"===a.className.baseVal;if(o||"tspan"!==d3.event.target.tagName||"node"!==a.parentNode.className.baseVal||(o=!0,a=a.parentNode),o){var c=a,p=c.getAttribute("data-name"),u=i(e,p),d=l(e,u.row,u.column);e.__tooltip.html(u.tooltipHTML).style("display","block");var y=e.__tooltip.node().getBoundingClientRect(),h=y.width,m=y.height,_=d.x+r,g=d.y+r;_+h>n&&(_=n+r-h),(g-=10+m)<r&&g>=r-5&&(g=r),g<r-5&&(g=d.y+r+s.cellSize-m,_=_+s.cellSize+10+h<n?d.x+r+s.cellSize+10:d.x+r-h-10),t.setStyles(e.__tooltip,{left:_+"px",top:g+"px"}),e.__tooltip.transition().duration(200).style("opacity",e.__tooltipAlpha),d3.select(c).classed("active",!0)}}),a.on("mouseout",function(){e.__tooltip.transition().delay(200).duration(200).style("opacity",0).on("end",function(){e.__tooltip.style("display","none")}),a.select(".node.active").classed("active",!1)})},r=function(e){var a=e.__settings,r=e.__container.append("div"),l=r.append("svg"),o=a.cellSize*a.numColumns,i=a.cellSize*a.numRows;l.attr("class","simple-diagram"),r.style("position","relative"),t.setAttrs(l,{height:i+2*a.margin,width:o+2*a.margin});var c=l.append("defs"),p=l.append("g");p.attr("transform","translate("+a.margin+","+a.margin+")");var u=c.append("marker");t.setAttrs(u,{id:"arrow",refX:8,refY:3,markerUnit:"userSpaceOnUse",markerWidth:8,markerHeight:6,orient:"auto"}),u.append("path").attr("d","M 0 0 8 3 0 6 Z"),a.addGrid&&s(p,a);var d=p.append("g");d.attr("class","canvas"),e.__canvas=d,e.__nodeData={},a.interactive&&(e.__tooltip=r.append("div"),e.__tooltip.attr("class","simple-diagram-tooltip"),t.setStyles(e.__tooltip,{position:"absolute",display:"none"}),e.__tooltipAlpha=e.__tooltip.style("opacity"),e.__tooltip.style("opacity",0),n(e))},l=function(t,e,a){return{x:(a-1)*t.__settings.cellSize,y:(e-1)*t.__settings.cellSize}},o=function(e,a){var s,n=t.cloneShallow(a);e.__settings.interactive&&(s=(s=a.hoverText).replace(/\^{([^}]*)}/,"<sup>$1</sup>").replace(/\_{([^}]*)}/,"<sub>$1</sub>"),n.tooltipHTML=s),e.__nodeData[a.name]=n},i=function(t,e){return t.__nodeData[e]},c=function(a,s,n){var r=l(a,s.row,s.column),o=s.label,i=o.search(e.subscript)>-1,c=o.search(e.superscript)>-1;i&&(o=o.replace(e.subscript,"%%<sub>$1</sub>%%")),c&&(o=o.replace(e.superscript,"%%<sup>$1</sup>%%"));var p=o.split("%%"),u=document.createElementNS(d3.namespaces.svg,"text"),d=d3.select(u);t.setAttrs(d,{x:r.x+a.__settings.cellSize/2,y:r.y+a.__settings.cellSize/2,"text-anchor":s.align||"middle",class:"label"}),n||a.getCanvas().node().appendChild(d.node()),s.class&&d.classed(s.class,!0),s.style&&d.style(s.style);var y,h=-.6,m=.3;return y=i?-.2:c?-.4:-.3,p.forEach(function(t){if(t){var e,a=d.append("tspan");t.search("<sup>")>-1?(e=t.replace(/<sup>(.*?)<\/sup>/,"$1"),a.attr("dy",h-y+"em"),a.attr("class","superscript"),y=h):t.search("<sub>")>-1?(e=t.replace(/<sub>(.*?)<\/sub>/,"$1"),a.attr("dy",m-y+"em"),a.attr("class","subscript"),y=m):(e=t,a.attr("dy",-y+"em"),y=0),a.text(e)}}),d},p=function(t,e,a){var s,n=e.column>a.column,r=l(t,e.row,e.column),o=l(t,a.row,a.column),i=t.__settings.cellSize,c=i/2,p=r.x+c,u=r.y+c,d=o.x+c,y=o.y+c,h=p===d?NaN:(y-u)/(d-p);return n&&(c*=-1),h>=2||isNaN(h)&&y>u?(u+=c,y-=c):h>=1?(p+=c,u+=c,d-=c,y-=c):h>-1?(p+=c,d-=c):h>-2?(p+=c,u-=c,d-=c,y+=c):(u-=c,y+=c),s=isNaN(h)?Math.PI/2+(y<u?-1:1)*Math.PI/2:Math.atan(h)+(n?-1:1)*Math.PI/2,"circle"===e.shape?(p=r.x+i/2*(1+Math.cos(s-Math.PI/2)),u=r.y+i/2*(1+Math.sin(s-Math.PI/2))):null===e.shape&&(p=r.x+i/2,u=r.y+i/2),"circle"===a.shape?(d=o.x+i/2*(1-Math.cos(Math.PI/2-s)),y=o.y+i/2*(1+Math.sin(Math.PI/2-s))):null===a.shape&&(d=o.x+i/2,y=o.y+i/2),{x1:p,y1:u,x2:d,y2:y}},u=function(e,a){void 0===a.addArrow&&(a.addArrow=!0);var s,n;"string"==typeof a.from?s=i(e,a.from):a.from instanceof Array&&(s={row:a.from[0],column:a.from[1],shape:null}),"string"==typeof a.to?n=i(e,a.to):a.to instanceof Array&&(n={row:a.to[0],column:a.to[1],shape:null});var r=p(e,s,n),l=e.getCanvas().append("line");t.setAttrs(l,r),l.attr("class","line"),a.addArrow&&l.attr("marker-end","url(#arrow)"),a.class&&l.classed(a.class,!0),a.style&&l.style(a.style)},d=function(e,a){var s=l(e,a.row,a.column),n=a.width*e.__settings.cellSize,r=a.height*e.__settings.cellSize,o=e.getCanvas().append("rect");t.setAttrs(o,{class:"box",x:s.x,y:s.y,width:n,height:r}),a.class&&o.classed(a.class,!0),a.style&&o.style(a.style)},y=function(e,a,s){var n,r=l(e,a.row,a.column),o=e.__settings.cellSize;"circle"===a.shape?(n=s.append("circle"),t.setAttrs(n,{cx:r.x+o/2,cy:r.y+o/2,r:o/2})):(n=s.append("rect"),t.setAttrs(n,{x:r.x,y:r.y,width:o,height:o})),n.attr("class","node-shape "+a.shape),a.style&&n.style(a.style)},h=function(t,e){"circle"!==e.shape&&"square"!==e.shape&&(e.shape="circle");var a=t.getCanvas().append("g");a.attr("class","node"),a.attr("data-name",e.name),o(t,e),e.style=e.shapeStyle,y(t,e,a),e.style=e.labelStyle;var s=c(t,e,!0);a.node().appendChild(s.node()),e.class&&a.classed(e.class,!0)},m=function(e,s){return this.__container=d3.select(e),this.__settings=t.mergeObjects(a,s),r(this),this};m.prototype.addNode=function(t){return h(this,t),this},m.prototype.addLine=function(t){return u(this,t),this},m.prototype.addLabel=function(t){return c(this,t,!1),this},m.prototype.addBox=function(t){return d(this,t),this},m.prototype.getCoordinatesAtCell=function(t,e){return l(this,t,e)},m.prototype.getCanvas=function(){return this.__canvas},window.SimpleDiagram=m}();